# **'ê´€ì‹¬ í”„ë¡œì íŠ¸' ê¸°ëŠ¥ ë°±ì—”ë“œ êµ¬í˜„**

## ğŸ“š ëª©ì°¨

1. [ì´ˆê¸° ë¬¸ì œ ìƒí™©](#1_ê¸°ëŠ¥_ê°œìš”)
2. [ë°ì´í„° ëª¨ë¸-entity](#2_ë°ì´í„°_ëª¨ë¸_entity)
3. [ë°ì´í„° ì ‘ê·¼ ê³„ì¸µ-repository](#3_ë°ì´í„°_ì ‘ê·¼_ê³„ì¸µ-repository)
4. [ì„œë¹„ìŠ¤ ê³„ì¸µ-business logic](#4_ì„œë¹„ìŠ¤_ê³„ì¸µ-business_logic)
5. [api ê³„ì¸µ-controller](#5_api_ê³„ì¸µ-controller)
6. [ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì™€ì˜ ì—°ë™ ë° í™œìš©](#6_ë‹¤ë¥¸_ì„œë¹„ìŠ¤ì™€ì˜_ì—°ë™_ë°_í™œìš©)

---

## **1. ê¸°ëŠ¥ ê°œìš”**

'ê´€ì‹¬ í”„ë¡œì íŠ¸'ëŠ” ì‚¬ìš©ìê°€ í¥ë¯¸ë¡œìš´ í”„ë¡œì íŠ¸ë¥¼ ì €ì¥(ì°œí•˜ê¸°)í•˜ê³ , ë‚˜ì¤‘ì— ì‰½ê²Œ ì°¾ì•„ë³¼ ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê¸°ëŠ¥ì´ë‹¤. í•µì‹¬ ê¸°ëŠ¥ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

- **ê´€ì‹¬ ë“±ë¡/í•´ì œ (Toggle):** ì‚¬ìš©ìëŠ” ë²„íŠ¼ í´ë¦­ í•œ ë²ˆìœ¼ë¡œ íŠ¹ì • í”„ë¡œì íŠ¸ë¥¼ ê´€ì‹¬ ëª©ë¡ì— ì¶”ê°€í•˜ê±°ë‚˜ ì œê±°í•  ìˆ˜ ìˆë‹¤.
- **ê´€ì‹¬ ëª©ë¡ ì¡°íšŒ:** ì‚¬ìš©ìëŠ” ìì‹ ì´ ê´€ì‹¬ ë“±ë¡í•œ ëª¨ë“  í”„ë¡œì íŠ¸ì˜ ëª©ë¡ì„ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.
- **ìƒíƒœ í‘œì‹œ:** í”„ë¡œì íŠ¸ ëª©ë¡ì„ ë³¼ ë•Œ, ê° í”„ë¡œì íŠ¸ì— ëŒ€í•´ í˜„ì¬ ì‚¬ìš©ìì˜ ê´€ì‹¬ ë“±ë¡ ì—¬ë¶€(`isInterested`)ê°€ í•¨ê»˜ í‘œì‹œëœë‹¤.

---

## **2. ë°ì´í„° ëª¨ë¸ (Entity)**

ì‚¬ìš©ì(`Profile`)ì™€ í”„ë¡œì íŠ¸(`Project`) ê°„ì˜ **ë‹¤ëŒ€ë‹¤(Many-to-Many)** ê´€ê³„ë¥¼ í‘œí˜„í•˜ê¸° ìœ„í•´, `InterestProject`ë¼ëŠ” ë³„ë„ì˜ ì¡°ì¸ í…Œì´ë¸” ì—”í‹°í‹°ë¥¼ ì„¤ê³„í–ˆë‹¤.

- **í•µì‹¬ ì—­í• :** ì–´ë–¤ `Profile`ì´ ì–´ë–¤ `Project`ì— ê´€ì‹¬ì„ ê°€ì¡ŒëŠ”ì§€ ê¸°ë¡í•œë‹¤.
- **êµ¬ì¡°:** `profile_id`, `project_id`ë¥¼ ì™¸ë˜ í‚¤ë¡œ ê°€ì§€ë©°, ë‘ IDì˜ ì¡°í•©ì´ í•˜ë‚˜ì˜ ê´€ì‹¬ ê´€ê³„ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤.

```java
// InterestProject.java
package com.Gathering_be.domain;

import jakarta.persistence.*;
import lombok.Builder;
import lombok.Getter;
import lombok.NoArgsConstructor;

@Entity
@NoArgsConstructor
@Getter
public class InterestProject {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "profile_id", nullable = false)
    private Profile profile;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "project_id", nullable = false)
    private Project project;

    @Builder
    public InterestProject(Long id, Profile profile, Project project) {
        this.id = id;
        this.profile = profile;
        this.project = project;
    }
}
```

---

## **3. ë°ì´í„° ì ‘ê·¼ ê³„ì¸µ (Repository)**

Spring Data JPAë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì™€ì˜ ìƒí˜¸ì‘ìš©ì„ ì²˜ë¦¬í•œë‹¤. `profileId`ì™€ `projectId`ë¥¼ ì¡°í•©í•˜ì—¬ íš¨ìœ¨ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì¡°íšŒ, í™•ì¸, ì‚­ì œí•˜ëŠ” ì¿¼ë¦¬ ë©”ì„œë“œë¥¼ ì •ì˜í–ˆë‹¤.

- **ì£¼ìš” ë©”ì„œë“œ:**
  - `existsByProfileIdAndProjectId(...)`: íŠ¹ì • ì‚¬ìš©ìê°€ íŠ¹ì • í”„ë¡œì íŠ¸ì— ì´ë¯¸ ê´€ì‹¬ì„ ë“±ë¡í–ˆëŠ”ì§€ `boolean` ê°’ìœ¼ë¡œ ë¹ ë¥´ê²Œ í™•ì¸í•œë‹¤. (í† ê¸€ ë¡œì§ì˜ í•µì‹¬)
  - `deleteByProfileIdAndProjectId(...)`: íŠ¹ì • ê´€ì‹¬ ë“±ë¡ ê¸°ë¡ì„ íš¨ìœ¨ì ìœ¼ë¡œ ì‚­ì œí•œë‹¤.
  - `findAllByProfileId(...)`: íŠ¹ì • ì‚¬ìš©ìì˜ ëª¨ë“  ê´€ì‹¬ í”„ë¡œì íŠ¸ IDë¥¼ ì¡°íšŒí•˜ì—¬, ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì—ì„œ `isInterested` ìƒíƒœë¥¼ í™•ì¸í•˜ëŠ” ë° ì‚¬ìš©ëœë‹¤.

```java
// InterestProjectRepository.java
package com.Gathering_be.repository;

import com.Gathering_be.domain.InterestProject;
import org.springframework.data.jpa.repository.JpaRepository;
import java.util.List;

public interface InterestProjectRepository extends JpaRepository<InterestProject, Long> {
    List<InterestProject> findByProfileNickname(String nickname);
    boolean existsByProfileIdAndProjectId(Long profileId, Long projectId);
    void deleteByProfileIdAndProjectId(Long profileId, Long projectId);
    List<InterestProject> findAllByProfileId(Long profileId);
}
```

---

## **4. ì„œë¹„ìŠ¤ ê³„ì¸µ (Business Logic)**

í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ `InterestProjectService`ì—ì„œ ì²˜ë¦¬í•œë‹¤. ëª¨ë“  ë©”ì„œë“œëŠ” ìš”ì²­ì„ ë³´ë‚¸ ì‚¬ìš©ìê°€ í•´ë‹¹ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•  ê¶Œí•œì´ ìˆëŠ”ì§€ `validateMemberAccess`ë¥¼ í†µí•´ ì² ì €íˆ ê²€ì¦í•œë‹¤.

- **`toggleInterestProject` (ê´€ì‹¬ ë“±ë¡/í•´ì œ):**
  1. `existsByProfileIdAndProjectId`ë¥¼ í†µí•´ í˜„ì¬ ê´€ì‹¬ ë“±ë¡ ìƒíƒœë¥¼ í™•ì¸í•œë‹¤.
  2. **ë§Œì•½ ì´ë¯¸ ì¡´ì¬í•œë‹¤ë©´,** ìƒˆë¡œìš´ `InterestProject` ì—”í‹°í‹°ë¥¼ ìƒì„±í•˜ì—¬ ì €ì¥í•˜ê³  `true`ë¥¼ ë°˜í™˜í•œë‹¤.
  3. ì´ 'í† ê¸€(Toggle)' ë°©ì‹ì„ í†µí•´ í•˜ë‚˜ì˜ APIë¡œ ë‘ ê°€ì§€ ê¸°ëŠ¥ì„ ëª¨ë‘ ì²˜ë¦¬í•˜ì—¬ íš¨ìœ¨ì„±ì„ ë†’ì˜€ë‹¤.
- **`getInterestProjects` (ê´€ì‹¬ ëª©ë¡ ì¡°íšŒ):**

  1. `findByProfileNickname`ì„ í†µí•´ íŠ¹ì • ì‚¬ìš©ìì˜ ëª¨ë“  ê´€ì‹¬ í”„ë¡œì íŠ¸ ëª©ë¡ì„ ì¡°íšŒí•˜ì—¬ DTOë¡œ ë³€í™˜ í›„ ë°˜í™˜í•œë‹¤.

  ```java
  // InterestProjectService.java
  package com.Gathering_be.service;

  import com.Gathering_be.domain.InterestProject;
  // ... (ê¸°íƒ€ import)

  @Service
  @RequiredArgsConstructor
  public class InterestProjectService {
    private final ProfileRepository profileRepository;
    private final ProjectRepository projectRepository;
    private final InterestProjectRepository interestProjectRepository;

    @Transactional
    public boolean toggleInterestProject(InterestProjectRequest request) {
        // ... (ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ ë° ê¶Œí•œ í™•ì¸) ...

        boolean exists = interestProjectRepository
                                            .existsByProfileIdAndProjectId(profileId, projectId);

        if (exists) {
            interestProjectRepository
                .deleteByProfileIdAndProjectId(profileId, projectId);
            return false; // ê´€ì‹¬ í•´ì œë¨
        } else {
            InterestProject interestProject = InterestProject.builder()
                    .profile(profile)
                    .project(getProjectById(projectId))
                    .build();
            interestProjectRepository.save(interestProject);
            return true; // ê´€ì‹¬ ë“±ë¡ë¨
        }
    }
    // ... (getInterestProjects ë° private í—¬í¼ ë©”ì„œë“œ) ...
  }


  ```

---

## **5. API ê³„ì¸µ (Controller)**

`InterestProjectController`ëŠ” ì™¸ë¶€ ìš”ì²­ì„ ë°›ì•„ `InterestProjectService`ì˜ ë¡œì§ì„ í˜¸ì¶œí•˜ëŠ” ì°½êµ¬ ì—­í• ì„ í•œë‹¤.

- **`POST /api/project/interest`:** `projectId`ë¥¼ ë°›ì•„ `toggleInterestProject`ì„œë¹„ìŠ¤ë¥¼ í˜¸ì¶œí•˜ê³ , ë³€ê²½ëœ ê´€ì‹¬ ìƒíƒœ(`true`/`false`)ë¥¼ ë°˜í™˜í•œë‹¤.
- **`GET /api/project/interest/{nickname}`:** `nickname`ì„ ë°›ì•„ `getInterestProjects` ì„œë¹„ìŠ¤ë¥¼ í˜¸ì¶œí•˜ê³ , í•´ë‹¹ ì‚¬ìš©ìì˜ ê´€ì‹¬ í”„ë¡œì íŠ¸ ëª©ë¡ì„ ë°˜í™˜í•œë‹¤.

```java
  // InterestProjectController.java
package com.Gathering_be.controller;

import com.Gathering_be.dto.request.InterestProjectRequest;
// ... (ê¸°íƒ€ import)

@RestController
@RequestMapping("/api/project/interest")
@RequiredArgsConstructor
public class InterestProjectController {
    private final InterestProjectService interestProjectService;

    @PostMapping
    public ResultResponse toggleInterestProject(@RequestBody InterestProjectRequest request) {
        boolean isInterest = interestProjectService.toggleInterestProject(request);
        return ResultResponse.of(ResultCode.INTEREST_PROJECT_TOGGLE_SUCCESS, isInterest);
    }

    @GetMapping("/{nickname}")
    public ResultResponse getInterestProjects(@PathVariable String nickname) {
        List<InterestProjectResponse> projects = interestProjectService.getInterestProjects(nickname);
        return ResultResponse.of(ResultCode.INTEREST_PROJECT_GET_SUCCESS, projects);
    }
}
```

---

## **6. ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì™€ì˜ ì—°ë™ ë° í™œìš©**

`ProjectService`ë‚˜ `ApplicationService`ì™€ ê°™ì´, í”„ë¡œì íŠ¸ ëª©ë¡ì„ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì¤˜ì•¼ í•˜ëŠ” ëª¨ë“  ê³³ì—ì„œëŠ” `isInterested` í•„ë“œë¥¼ ì±„ì›Œì£¼ê¸° ìœ„í•´ `InterestProjectRepository`ë¥¼ ì§ì ‘ í™œìš©í•œë‹¤.

- **ì„¤ê³„ ê²°ì •:** ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ì•„ë‹Œ ë‹¨ìˆœ ì¡°íšŒë¥¼ ìœ„í•´ `InterestProjectService`ë¥¼ ê±°ì¹˜ì§€ ì•Šê³ , `InterestProjectRepository`ë¥¼ ì§ì ‘ ì£¼ì…ë°›ì•„ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ ì„œë¹„ìŠ¤ ê°„ì˜ ë¶ˆí•„ìš”í•œ ê²°í•©ë„ë¥¼ ë‚®ì¶”ê³  ì„±ëŠ¥ì„ ìµœì í™”í–ˆë‹¤.
- **êµ¬í˜„ íŒ¨í„´:**

  1. í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ `Profile ID`ë¥¼ ê°€ì ¸ì˜¨ë‹¤.
  2. `interestProjectRepository.findAllByProfileId()`ë¥¼ í˜¸ì¶œí•˜ì—¬ í•´ë‹¹ ì‚¬ìš©ìê°€ ê´€ì‹¬ ë“±ë¡í•œ ëª¨ë“  í”„ë¡œì íŠ¸ì˜ IDë¥¼ Set<Long> í˜•íƒœë¡œ ë¯¸ë¦¬ ì¤€ë¹„í•œë‹¤.
  3. ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì¤„ í”„ë¡œì í‹‘ ëª©ë¡ì„ ìˆœíšŒí•˜ë©´ì„œ, ê° í”„ë¡œì íŠ¸ì˜ IDê°€ ìœ„ì—ì„œ ë§Œë“  `Set`ì— í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì—¬ `isInterested` ê°’ì„ `true` ë˜ëŠ” `false`ë¡œ ì„¤ì •í•œë‹¤.

  ```java
  // ProjectService.java (í™œìš© ì˜ˆì‹œ)
  public Page<ProjectSimpleResponse> searchProjectsWithFilters(...) {
      // ...
      // 1 & 2. í˜„ì¬ ì‚¬ìš©ìì˜ ëª¨ë“  ê´€ì‹¬ í”„ë¡œì íŠ¸ IDë¥¼ Setìœ¼ë¡œ ë¯¸ë¦¬ ì¤€ë¹„
      Set<Long> interestedProjectIds = interestProjectRepository.findAllByProfileId(...)
              .stream()
              .map(interest -> interest.getProject().getId())
              .collect(Collectors.toSet());

      // 3. í”„ë¡œì íŠ¸ ëª©ë¡ì„ DTOë¡œ ë³€í™˜í•  ë•Œ, Setì— í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì—¬ isInterested ê°’ ì„¤ì •
      return projectPage
              .map(project -> ProjectSimpleResponse.from(project, interestedProjectIds.contains(project.getId()), null));
  }


  ```

---
